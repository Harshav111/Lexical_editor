"use strict";(self.webpackChunklexical_editor=self.webpackChunklexical_editor||[]).push([[987],{3368:(e,t,r)=>{r.r(t),r.d(t,{default:()=>f});r(4820);var n=r(9552),i=(r(1136),r(2551)),s=(r(3146),r(2285),r(961),r(5905),r(710),r(4157)),o=r(7197),a=r(7488),c=r(5043),l=r(579);function u(e,t,r){return Math.min(Math.max(e,t),r)}const d={east:1,north:8,south:2,west:4};function h(e){let{onResizeStart:t,onResizeEnd:r,buttonRef:n,imageRef:i,maxWidth:s,editor:o,showCaption:a,setShowCaption:h,captionsEnabled:g}=e;const m=(0,c.useRef)(null),p=(0,c.useRef)({priority:"",value:"default"}),f=(0,c.useRef)({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),C=o.getRootElement(),w=s||(null!==C?C.getBoundingClientRect().width-20:100),R=null!==C?C.getBoundingClientRect().height-20:100,y=(e,r)=>{if(!o.isEditable())return;const n=i.current,s=m.current;if(null!==n&&null!==s){const{width:i,height:o}=n.getBoundingClientRect(),a=f.current;a.startWidth=i,a.startHeight=o,a.ratio=i/o,a.currentWidth=i,a.currentHeight=o,a.startX=e.clientX,a.startY=e.clientY,a.isResizing=!0,a.direction=r,(e=>{const t=e===d.east||e===d.west,r=e===d.north||e===d.south,n=e&d.north&&e&d.west||e&d.south&&e&d.east,i=t?"ew":r?"ns":n?"nwse":"nesw";null!==C&&C.style.setProperty("cursor","".concat(i,"-resize"),"important"),null!==document.body&&(document.body.style.setProperty("cursor","".concat(i,"-resize"),"important"),p.current.value=document.body.style.getPropertyValue("-webkit-user-select"),p.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))})(r),t(),s.classList.add("image-control-wrapper--resizing"),n.style.height="".concat(o,"px"),n.style.width="".concat(i,"px"),document.addEventListener("pointermove",N),document.addEventListener("pointerup",x)}},N=e=>{const t=i.current,r=f.current,n=r.direction&(d.east|d.west),s=r.direction&(d.south|d.north);if(null!==t&&r.isResizing)if(n&&s){let n=Math.floor(r.startX-e.clientX);n=r.direction&d.east?-n:n;const i=u(r.startWidth+n,100,w),s=i/r.ratio;t.style.width="".concat(i,"px"),t.style.height="".concat(s,"px"),r.currentHeight=s,r.currentWidth=i}else if(s){let n=Math.floor(r.startY-e.clientY);n=r.direction&d.south?-n:n;const i=u(r.startHeight+n,100,R);t.style.height="".concat(i,"px"),r.currentHeight=i}else{let n=Math.floor(r.startX-e.clientX);n=r.direction&d.east?-n:n;const i=u(r.startWidth+n,100,w);t.style.width="".concat(i,"px"),r.currentWidth=i}},x=()=>{const e=i.current,t=f.current,n=m.current;if(null!==e&&null!==n&&t.isResizing){const e=t.currentWidth,i=t.currentHeight;t.startWidth=0,t.startHeight=0,t.ratio=0,t.startX=0,t.startY=0,t.currentWidth=0,t.currentHeight=0,t.isResizing=!1,n.classList.remove("image-control-wrapper--resizing"),null!==C&&C.style.setProperty("cursor","default"),null!==document.body&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",p.current.value,p.current.priority)),r(e,i),document.removeEventListener("pointermove",N),document.removeEventListener("pointerup",x)}};return(0,l.jsxs)("div",{ref:m,children:[!a&&g&&(0,l.jsx)("button",{className:"image-caption-button",ref:n,onClick:()=>{h(!a)},children:"Add Caption"}),(0,l.jsx)("div",{className:"image-resizer image-resizer-n",onPointerDown:e=>{y(e,d.north)}}),(0,l.jsx)("div",{className:"image-resizer image-resizer-ne",onPointerDown:e=>{y(e,d.north|d.east)}}),(0,l.jsx)("div",{className:"image-resizer image-resizer-e",onPointerDown:e=>{y(e,d.east)}}),(0,l.jsx)("div",{className:"image-resizer image-resizer-se",onPointerDown:e=>{y(e,d.south|d.east)}}),(0,l.jsx)("div",{className:"image-resizer image-resizer-s",onPointerDown:e=>{y(e,d.south)}}),(0,l.jsx)("div",{className:"image-resizer image-resizer-sw",onPointerDown:e=>{y(e,d.south|d.west)}}),(0,l.jsx)("div",{className:"image-resizer image-resizer-w",onPointerDown:e=>{y(e,d.west)}}),(0,l.jsx)("div",{className:"image-resizer image-resizer-nw",onPointerDown:e=>{y(e,d.north|d.west)}})]})}var g=r(1920);const m=new Set;function p(e){let{altText:t,className:r,imageRef:n,src:i,width:s,height:o,maxWidth:a}=e;return function(e){if(!m.has(e))throw new Promise((t=>{const r=new Image;r.src=e,r.onload=()=>{m.add(e),t(null)}}))}(i),(0,l.jsx)("img",{className:r||void 0,src:i,alt:t,ref:n,style:{height:o,maxWidth:a,width:s},draggable:"false"})}function f(e){let{src:t,altText:r,nodeKey:u,width:d,height:m,maxWidth:f,resizable:C,showCaption:w,caption:R,captionsEnabled:y}=e;const N=(0,c.useRef)(null),x=(0,c.useRef)(null),[M,b,v]=(0,s.useLexicalNodeSelection)(u),[E,z]=(0,c.useState)(!1),{isCollabActive:O}=(0,n.useCollaborationContext)(),[D]=(0,i.useLexicalComposerContext)(),[_,P]=(0,c.useState)(null),S=(0,c.useRef)(null),W=(0,c.useCallback)((e=>{if(M&&(0,a.$isNodeSelection)((0,a.$getSelection)())){e.preventDefault();const t=(0,a.$getNodeByKey)(u);(0,g.Eh)(t)&&t.remove(),b(!1)}return!1}),[M,u,b]),A=(0,c.useCallback)((e=>{const t=(0,a.$getSelection)(),r=x.current;if(M&&(0,a.$isNodeSelection)(t)&&1===t.getNodes().length){if(w)return(0,a.$setSelection)(null),e.preventDefault(),R.focus(),!0;if(null!==r&&r!==document.activeElement)return e.preventDefault(),r.focus(),!0}return!1}),[R,M,w]),L=(0,c.useCallback)((e=>(S.current===R||x.current===e.target)&&((0,a.$setSelection)(null),D.update((()=>{b(!0);const e=D.getRootElement();null!==e&&e.focus()})),!0)),[R,D,b]);(0,c.useEffect)((()=>{let e=!0;const t=(0,o.mergeRegister)(D.registerUpdateListener((t=>{let{editorState:r}=t;e&&P(r.read((()=>(0,a.$getSelection)())))})),D.registerCommand(a.SELECTION_CHANGE_COMMAND,((e,t)=>(S.current=t,!1)),a.COMMAND_PRIORITY_LOW),D.registerCommand(a.CLICK_COMMAND,(e=>{const t=e;return!!E||t.target===N.current&&(t.shiftKey?b(!M):(v(),b(!0)),!0)}),a.COMMAND_PRIORITY_LOW),D.registerCommand(a.DRAGSTART_COMMAND,(e=>e.target===N.current&&(e.preventDefault(),!0)),a.COMMAND_PRIORITY_LOW),D.registerCommand(a.KEY_DELETE_COMMAND,W,a.COMMAND_PRIORITY_LOW),D.registerCommand(a.KEY_BACKSPACE_COMMAND,W,a.COMMAND_PRIORITY_LOW),D.registerCommand(a.KEY_ENTER_COMMAND,A,a.COMMAND_PRIORITY_LOW),D.registerCommand(a.KEY_ESCAPE_COMMAND,L,a.COMMAND_PRIORITY_LOW));return()=>{e=!1,t()}}),[v,D,E,M,u,W,A,L,b]);const I=M&&(0,a.$isNodeSelection)(_)&&!E,Y=M||E;return(0,l.jsx)(c.Suspense,{fallback:null,children:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{draggable:I,children:(0,l.jsx)(p,{className:Y?"focused ".concat((0,a.$isNodeSelection)(_)?"draggable":""):null,src:t,altText:r,imageRef:N,width:d,height:m,maxWidth:f})}),C&&(0,a.$isNodeSelection)(_)&&Y&&(0,l.jsx)(h,{showCaption:w,setShowCaption:()=>{D.update((()=>{const e=(0,a.$getNodeByKey)(u);(0,g.Eh)(e)&&e.setShowCaption(!0)}))},editor:D,buttonRef:x,imageRef:N,maxWidth:f,onResizeStart:()=>{z(!0)},onResizeEnd:(e,t)=>{setTimeout((()=>{z(!1)}),200),D.update((()=>{const r=(0,a.$getNodeByKey)(u);(0,g.Eh)(r)&&r.setWidthAndHeight(e,t)}))},captionsEnabled:y})]})})}}}]);
//# sourceMappingURL=987.75d19e78.chunk.js.map